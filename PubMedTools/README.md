# Pipeline to Detect Tools and Databases

<b>Tools:</b> Online biological tools/databased that are published in PubMed. </br>
## Install packages
`requirements.txt`

## Create a PubMed account 
* Follow instructions: https://www.ncbi.nlm.nih.gov/books/NBK25497/#chapter2.Usage_Guidelines_and_Requiremen
* Save API Key and Email to the .env file.

## Clone Github repositories
1. BERT - https://github.com/google-research/bert
2. Signature-commons - https://github.com/MaayanLab/signature-commons

## Fine-tune BERT
1. Create a list of positive and negative examples and save them to `examples.csv` file with the following columns.
* Article.Abstract.AbstractText    -  abstract of the paper
* PMID    - Pubmed id of the paper
* valid_tool 
    * Positive example: `1` indicates an entry (paper) that is describing a tool
    * Negative example: `0` indicates an entry (paper) that is not a tool
  
2. Create a Gmail account and login to Google Drive.
3. Save `examples.csv` to the following folder in Google Drive: `/BERTTOOLS/examples.csv`
4. Train the BERT model on a downstream classification task by copying the `training.py` code to a new google Colab notebook:
https://colab.research.google.com/notebooks/intro.ipynb.
In the Colab notebook set hardware to GPU.

* The trained weights of the model are saved to `/BERTTOOLS/bert_output` folder on Google Drive for later usage.

## Collect Tools and Databases
Run ```0_main.sh``` file which runs the following scripts: </br>
```1_collect_data.py```
 </br> 
 <ul>
 <li> Collect articles from PubMed --> save as *.json.gz files to /data/jsons </li>
 <li> Filter articles from /data/jsons --> save articles that have a url in their title or abstract to /data/tools </li>
 </ul>

 ```2_extract_tools.py```
 <ul>
 <li> 
      Extract tool name and description from articles in /data/tools using rule-sets and NER
      --> Save to /data/tools.csv 
 </li>
 </ul>
 
 ```3_url_analysis.py```
  <ul>
 <li> 
      TRAINING [Do only once]
      The training code is in `training.py` on goole colab
      <ul>
        <li>
        Labeling [tool/not-tool]
        <ul>
         <li>
         Automatically assign labels using `is_tool()`</br>
         search for white/black-list words
        </li>
        </li>
        <li>
        Manual labeling
        </li>
       </ul>
       <li>
       Train (fine-tune) BERT with BioBERT weights on a classification task.
        </li>
        <li>
        Evaluate BERT performance
        </li>
      </ul>
 </li>
 
 <li> 
      Classify abstracts as tools/not-tools using the fine-tuned BERT model
 </li>
 <li> 
      Filter articles in the tools cluster:
   <ul>
       <li>
       keep only tools containing whitelist-words AND without blacklist-words in their abstract, title, or url
       </li>
       <li>
        Keep only websites that are working (urls)
       </li>
   </ul>
 </li> 
 </ul>
 
  ```4_get_data.py```
 <ul>
  <li> 
   Clean text, collect data from altmetric, collect number of citations from pubmed 
  </li>
  <li>
   Output: data/classified_tools.csv
  </li>
  </ul>
 
 ```5_text2vector```
 <ul>
  <li> 
      Create a word embedding vector for each tool --> save vectors [PMID].npy to /data/vectors
 </li>
 </ul>
 
 ```6_pushtools```
 <ul>
  <li> 
      Upload classified tools to btools website
 </li>
 </ul>
 
```7_dataupdate.py```
 <ul>
  <li> 
      Weekly update of Altmetric and citations metadata 
 </li>
 </ul>
 
```8_Fairshake.py```
 <ul>
  <li> 
      Automatic FAIR assessment of tools
 </li>
 </ul>
 
 ## Tools similarity API
 <ul>
  <li>
 Given a text --> get a json of {pmid:cosine_similarity_score}
  </li>
</ul>

 
# Details About The Collected Data
Details on Altmetric data:
https://docs.google.com/spreadsheets/d/1ndVY8Q2LOaZO_P_HDmSQulagjeUrS250mAL2N5V8GvY/edit#gid=0

Details on PubMed data:
https://www.nlm.nih.gov/bsd/licensee/elements_descriptions.html

Data source is PubMed unless indicated otherwise, e.g., (altmetric).


<ul>
 <li> Tool info generated by this script (or Altmetric)
   <ul>
                <li>tool_URL </li> 
                <li>tool_name</li>
                <li>tool_description </li>
                <li>is_tools_bert </li>
                <li>valid_tool </li>
                <li>status </li>
                <li>subjects (altmetric) </li>
                <li>type (altmetric)</li> 
                <li>url (altmetric)</li>
    </ul>
 </li>
 <li> Article info
  <ul>
                <li>doi</li>
                <li>Article.ELocationID</li>
                <li>pmid</li>
                <li>pmc (altmetric)</li>
                <li>KeywordList</li>
                <li>ChemicalList</li>
                <li>Article.Language</li>
                <li>Article.GrantList</li>
                <li>Article.Abstract.AbstractText</li>
                <li>Article.ArticleTitle</li> 
                <li>Article.AuthorList</li> 
                <li>Article.ArticleDate</li>
                <li>published_on</li> 
                <li>authors</li>
                <li>Article.Abstract.CopyrightInformation</li>
                <li>Article.DataBankList</li>
                <li>Article.Pagination.MedlinePgn</li>
                <li>Article.PublicationTypeList</li>
                <li>DateCompleted.Day</li>
                <li>DateCompleted.Month</li>
                <li>DateCompleted.Year</li>
                <li>DateRevised.Day</li>
                <li>DateRevised.Month</li>
                <li>DateRevised.Year</li>
   </ul>
<li> Journal info   
 <ul>
                <li>journal</li>
                <li>Article.Journal.ISOAbbreviation</li>
                <li>Article.Journal.ISSN</li>
                <li>Article.Journal.JournalIssue.Issue</li>
                <li>Article.Journal.JournalIssue.PubDate.Day</li>
                <li>Article.Journal.JournalIssue.PubDate.MedlineDate</li>
                <li>Article.Journal.JournalIssue.PubDate.Month</li>
                <li>Article.Journal.JournalIssue.PubDate.Year</li>
                <li>Article.Journal.JournalIssue.Volume</li>
                <li>Article.Journal.Title</li>
                <li>MedlineJournalInfo.Country</li> 
                <li>MedlineJournalInfo.ISSNLinking</li>
                <li>MedlineJournalInfo.MedlineTA</li>
                <li>MedlineJournalInfo.NlmUniqueID</li>
                <li>MeshHeadingList</li>
 </ul>
</li>
<li> Statistics info (altmetric) - some data are not available for all articles
  <ul>
               <li>details_url </li>
               <li>score</li>
               <li>num_citations</li> 
               <li>NumberOfReferences</li>
               <li>readers_count</li> 
               <li>pmc_ids</li>
               <li>added_on</li>
               <li>altmetric_id</li>
               <li>altmetric_jid</li>
               <li>cited_by_accounts_count</li> 
               <li>cited_by_fbwalls_count</li> 
               <li>cited_by_msm_count</li> 
               <li>cited_by_posts_count</li> 
               <li>cited_by_qna_count</li>
               <li>cited_by_rh_count</li>
               <li>cited_by_tweeters_count</li>
               <li>cohorts</li>
               <li>cohorts.pub</li>
               <li>cohorts.sci</li>
               <li>context.all.count</li>
               <li>context.all.higher_than</li>
               <li>context.all.mean</li>
               <li>context.all.pct</li>
               <li>context.all.rank</li>
               <li>context.journal.count</li>
               <li>context.journal.higher_than</li>
               <li>context.journal.mean</li>
               <li>context.journal.pct</li>
               <li>context.journal.rank</li>
               <li>context.similar_age_3m.count</li>
               <li>context.similar_age_3m.higher_than</li>
               <li>context.similar_age_3m.mean</li>
               <li>context.similar_age_3m.pct</li>
               <li>context.similar_age_3m.rank</li>
               <li>context.similar_age_journal_3m.count</li>
               <li>context.similar_age_journal_3m.higher_than</li>
               <li>context.similar_age_journal_3m.mean</li>
               <li>context.similar_age_journal_3m.pct</li>
               <li>context.similar_age_journal_3m.rank</li>
               <li>isbns</li>
               <li>issns</li>
               <li>last_updated</li>
               <li>publisher_subjects</li>
               <li>readers.citeulike</li>
               <li>readers.connotea</li>
               <li>readers.mendeley</li>
  </ul>
</li>
</ul>
